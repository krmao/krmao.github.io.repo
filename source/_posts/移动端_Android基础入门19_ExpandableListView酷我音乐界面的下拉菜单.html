---
title: 移动端_IOS【Android基础入门〖19〗】ExpandableListView酷我音乐界面的下拉菜单
date: 2013年10月27日 16:04:11
categories: [技术]
tags: [移动端]
---

<link rel="stylesheet" href="https://csdnimg.cn/public/common/toolbar/content_toolbar_css/content_toolbar.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/vendor/pagination/paging.css">

<div class="htmledit_views" id="content_views">
                
<p><span style="font-weight:bold;"><span style="color:#330000;"></span></span></p>
<p style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.98958396911621px;">
<span style="font-family:'Microsoft YaHei';font-size:12px;"><strong>/**************************************************************************************************</strong></span></p>
<p style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.98958396911621px;">
<span style="font-family:'Microsoft YaHei';font-size:12px;"><strong><span style="color:rgb(255,0,0);"> *  本博客为</span><span style="color:rgb(51,51,255);">CSDN博主【MK】原创</span><span style="color:rgb(255,0,0);">，博客</span><span style="line-height:25.98958396911621px;color:rgb(255,0,0);">地址：<span style="color:#6a3906;"></span><a href="http://blog.csdn.net/mkrcpp/article/details/13170649" rel="nofollow"><span style="color:#6a3906;">http://blog.csdn.net/mkrcpp/article/details/</span><span style="color:#6a3906;">13170649</span></a></span></strong></span></p>
<p style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.98958396911621px;">
<span style="font-family:'Microsoft YaHei';"><span style="font-size:12px;"> **********************************************************************************************************************/</span></span></p>
<p style="color:rgb(54,46,43);line-height:25.98958396911621px;"><span style="font-family:'Microsoft YaHei';"><span style="font-size:12px;"></span></span></p>
<p style="color:rgb(54,46,43);font-family:Arial;line-height:25.98958396911621px;">
<span style="font-size:14px;"></span></p>
<p><strong><span style="color:#330000;"><span style="font-size:14px;"><u>研究</u></span>了一夜</span><span style="color:#330000;">，</span><span style="color:#009900;">终于完毕，有一种成就感，虽然没什么成就......</span></strong></p>
<p></p>
<ul><li><strong>本以为那种下拉菜单方式是通过嵌套 ExpandableListView 搞定，甚是麻烦，最后因为子 ExpandableListView  的布局总是莫名其妙的多一点而止步。</strong><span style="font-weight:bold;">无奈之下，突然意识到我钻了牛角尖，这是好事 :)</span></li><li><span style="color:rgb(255,102,0);font-size:14px;"><strong><u>非常珍惜</u></strong></span><span style="color:rgb(255,102,0);"><strong>这些自己研究出来的东西，但是想想这点不过沧海一粟，重在分享，避免后来人再慢慢的研究，熬夜。</strong></span></li></ul><p></p>
<p><strong><span style="color:#ff0000;">点睛之笔：</span></strong></p>
<p></p>
<ul><li>用一个 ExpandableListView ，在其 Child 布局中设置好<strong><u>功能</u></strong>布局，事先<strong><u>隐藏</u></strong>，当我点击右侧的更多按钮时，在显示出来。</li><li>事实证明这是多么<strong><u>正确，省事，省时</u></strong>的思想，哈哈。</li></ul><p></p>
<p><strong>靓照：</strong></p>
<p></p>
<ul><li><img src="https://img-blog.csdn.net/20131028100335187" width="240" height="427" alt=""><img src="https://img-blog.csdn.net/20131028100349828" width="240" height="427" alt=""></li><li><img src="https://img-blog.csdn.net/20131028100343093" width="240" height="427" alt=""><br></li></ul><div><br></div>
<div><br></div>
<h2><u>详细步骤：</u></h2>
<div>
<div><strong></strong>
<div style="background-color:rgb(204,204,204);">这里就已上面第二张图为例吧，PlayList（播放列表）</div>
</div>
<div><span style="background-color:rgb(204,204,204);">功能描述：</span></div>
<div>
<ul><li><span style="background-color:rgb(204,204,204);">点击播放列表时，出现该列表下的所有歌曲</span></li><li><span style="background-color:rgb(204,204,204);">每一首歌曲都可以点击右侧的“更多”按钮，出现下面的功能菜单（有“喜欢”，“添加到”...的那一个）</span></li></ul></div>
</div>
<h5><span style="color:#ff0000;">NO.1 主布局文件</span></h5>
<div>playlist_fragment.xml</div>
<div>
<pre><code class="language-html">&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="match_parent" 
    android:background="#191c1f"
    xmlns:tools="http://schemas.android.com/tools" &gt;
    
    &lt;ExpandableListView
	    android:id="@+id/playlist_list"
	    android:layout_width="match_parent"
	    android:layout_height="wrap_content"
	    android:cacheColorHint="#00000000"
	    android:childDivider="#00000000"
	    android:dividerHeight="1dp"
	    android:groupIndicator="@null"
	    android:fastScrollEnabled="true"/&gt;
&lt;/LinearLayout&gt;</code></pre>
<h5></h5>
<h5><span style="color:rgb(255,0,0);">NO.2  ExpandableListView的</span>父布局<span style="color:rgb(255,0,0);">文件</span></h5>
<p><span style="font-weight:normal;">playlist_listitem_parent.xml<br></span></p>
<p></p>
<pre><code class="language-html"><span style="font-weight:normal;">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="40dp"
    android:background="@drawable/playlist_listitem_selector"
    tools:ignore="HardcodedText" &gt;
	&lt;TextView
	    android:id="@+id/playlist_parent_text"
	    android:layout_width="match_parent"
	    android:layout_height="40dp"
	    android:paddingLeft="3dp"
	    android:gravity="left|center_vertical"
	    android:layout_gravity="left|center_vertical"
	    android:text="M"
	    android:textColor="@color/whitesmoke"
	    android:textSize="15sp"
	    android:textStyle="bold"
	    tools:ignore="HardcodedText" /&gt;
&lt;/LinearLayout&gt;
</span></code></pre>
<span style="font-weight:normal;"></span>
<h5><span style="color:rgb(255,0,0);">NO.3  ExpandableListView的</span>子布局<span style="color:#ff0000;">文件</span></h5>
<p>default_listitem_child.xml<br></p>
<p></p>
<pre><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="50dp"
	android:orientation="vertical"
	android:background="#00000000"
	android:paddingLeft="3dp"
    tools:ignore="HardcodedText" &gt;

    &lt;LinearLayout
        android:layout_width="match_parent"
    	android:layout_height="wrap_content"
    	android:orientation="horizontal"
    	android:background="@drawable/default_listitem_selector"
		android:paddingLeft="10dp"
		android:paddingTop="10dp"
		android:paddingBottom="10dp"&gt;
	    &lt;LinearLayout
	        android:layout_width="wrap_content"
	        android:layout_height="wrap_content"
	        android:orientation="vertical" &gt;
	
	        &lt;TextView
	            android:id="@+id/default_music_name"
	            android:layout_width="match_parent"
	            android:layout_height="wrap_content"
	            android:layout_weight="1"
	            android:text="大城小爱"
	            android:textSize="15sp"
	            android:textStyle="bold"
	            android:gravity="center_vertical|left"
	            android:textColor="@color/whitesmoke" /&gt;
	        
	        &lt;TextView
	            android:id="@+id/default_singer_name"
	            android:layout_width="match_parent"
	            android:layout_height="wrap_content"
	            android:layout_weight="1"
	            android:text="王力宏"
	            android:textSize="12sp"
	            android:gravity="center_vertical|left"
	            android:textColor="#8d8d8d" /&gt;
	    &lt;/LinearLayout&gt;
	    &lt;View android:layout_height="match_parent" android:layout_width="0dp" android:layout_weight="1"/&gt;
	    &lt;ImageView
	        android:id="@+id/default_more"
	        android:layout_width="wrap_content"
	        android:layout_height="wrap_content"
	        android:layout_gravity="right|center_vertical"
	        android:contentDescription="rightbtn"
	        android:scaleType="fitCenter"
	        android:focusable="false"
	        android:clickable="true"
	        android:src="@drawable/default_item_more_selector"/&gt;
    &lt;/LinearLayout&gt;
	&lt;LinearLayout
	    android:id="@+id/settings_layout"
		android:layout_width="match_parent"
  		android:layout_height="wrap_content"
  		android:visibility="gone"
  		android:background="@color/black"
  		android:orientation="horizontal"&gt;
	    &lt;TextView
	        android:drawableTop="@drawable/settings_love_selector"
			android:layout_width="wrap_content"
  			android:layout_height="wrap_content"
  			android:layout_weight="1"
  			android:clickable="true"
  			android:focusable="false"
  			android:textColor="@color/whitesmoke"
  			android:gravity="center"
  			android:text="喜欢"/&gt;
	    &lt;TextView
	        android:layout_marginLeft="10dp"
	        android:drawableTop="@drawable/settings_add_selector"
			android:layout_width="wrap_content"
  			android:layout_height="wrap_content"
  			android:clickable="true"
  			android:focusable="false"
  			android:layout_weight="1"
  			android:textColor="@color/whitesmoke"
  			android:gravity="center"
  			android:text="添加到"/&gt;
	    &lt;TextView
	        android:layout_marginLeft="10dp"
	        android:drawableTop="@drawable/settings_del_selector"
			android:layout_width="wrap_content"
  			android:layout_height="wrap_content"
  			android:layout_weight="1"
  			android:clickable="true"
  			android:focusable="false"
  			android:textColor="@color/whitesmoke"
  			android:gravity="center"
  			android:text="删除"/&gt;
	    &lt;TextView
	        android:layout_marginLeft="10dp"
	        android:drawableTop="@drawable/settings_info_selector"
			android:layout_width="wrap_content"
  			android:layout_height="wrap_content"
  			android:layout_weight="1"
  			android:textColor="@color/whitesmoke"
  			android:clickable="true"
  			android:focusable="false"
  			android:gravity="center"
  			android:text="信息"/&gt;
	    &lt;TextView
	        android:layout_marginLeft="10dp"
	        android:drawableTop="@drawable/settings_set_selector"
			android:layout_width="wrap_content"
  			android:layout_height="wrap_content"
  			android:layout_weight="1"
  			android:textColor="@color/whitesmoke"
  			android:gravity="center"
  			android:clickable="true"
  			android:focusable="false"
  			android:text="设置"/&gt;
	&lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;</code></pre>
<p></p>
<h5><span style="color:#ff0000;">NO.4  自定义BaseExpandableListAdapter</span></h5>
<pre><code class="language-java">package com.supermusic.adapter;

import java.util.ArrayList;
import java.util.HashMap;

import com.supermusic.R;
import com.supermusic.util.Music;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.View.OnClickListener;
import android.widget.BaseExpandableListAdapter;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

@SuppressWarnings("unchecked")
public class Playlist_ExListAdapter extends BaseExpandableListAdapter {

	private Context context=null;
	private ArrayList&lt;HashMap&lt;String,Object&gt;&gt;allData=null;
	
	public Playlist_ExListAdapter(Context context, ArrayList&lt;HashMap&lt;String,Object&gt;&gt;allData)
	{
		this.context=context;
		this.allData=allData;
		
	}
	
	@Override
	public int getGroupCount() {
		// 返回组的数量
		return allData.size();
	}


	@Override
	public int getChildrenCount(int groupPosition) {
		// 返回指定组的 Child 数量
		HashMap&lt;String,Object&gt;oneData=(HashMap&lt;String,Object&gt;)allData.get(groupPosition);
		ArrayList&lt;Music&gt;childData=(ArrayList&lt;Music&gt;)oneData.get("childData");
		return childData.size();
	}

	@Override
	public Object getGroup(int groupPosition) {
		// 返回指定组的数据
		HashMap&lt;String,Object&gt;oneData=(HashMap&lt;String,Object&gt;)allData.get(groupPosition);
		String parentData=(String)oneData.get("parentData");
		return parentData;
	}

	@Override
	public Object getChild(int groupPosition, int childPosition) {
		// 返回指定组之指定 Child 的数据
		HashMap&lt;String,Object&gt;oneData=(HashMap&lt;String,Object&gt;)allData.get(groupPosition);
		ArrayList&lt;Music&gt;childData=(ArrayList&lt;Music&gt;)oneData.get("childData");
		return childData.get(childPosition);
	}

	@Override
	public long getGroupId(int groupPosition) {
		// 返回指定组的ID
		return groupPosition;
	}

	@Override
	public long getChildId(int groupPosition, int childPosition) {
		// 返回指定组之指定 Child 的ID
		return childPosition;
	}

	@Override
	public boolean hasStableIds() {
		// 组以及 Child 的ID是否是固定不变的？
		return false;
	}

	@Override
	public View getGroupView(int groupPosition, boolean isExpanded,
			View convertView, ViewGroup parent) {
		// 返回组的布局
		convertView=LayoutInflater.from(context).inflate(R.layout.playlist_listitem_parent, null);
		
		HashMap&lt;String,Object&gt;oneData=(HashMap&lt;String,Object&gt;)allData.get(groupPosition);
		String parentData=(String)oneData.get("parentData");
		TextView textview=(TextView)convertView.findViewById(R.id.playlist_parent_text);
		textview.setText(parentData);

		return convertView;
	}

	@Override
	public View getChildView(int groupPosition, final int childPosition,
			boolean isLastChild, View convertView, ViewGroup parent) {
		// 返回 Child 的布局
		convertView=LayoutInflater.from(context).inflate(R.layout.default_listitem_child, null);
		
		HashMap&lt;String,Object&gt;oneData=(HashMap&lt;String,Object&gt;)allData.get(groupPosition);
		ArrayList&lt;Music&gt;childData=(ArrayList&lt;Music&gt;)oneData.get("childData");
		Music music = childData.get(childPosition);
		TextView music_name=(TextView)convertView.findViewById(R.id.default_music_name);
		TextView singer_name=(TextView)convertView.findViewById(R.id.default_singer_name);
		ImageView btn_more=(ImageView)convertView.findViewById(R.id.default_more);
		final LinearLayout settings_layout=(LinearLayout)convertView.findViewById(R.id.settings_layout);
		
		music_name.setText(music.music_name);
		singer_name.setText(music.singer_name);
		btn_more.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				settings_layout.setVisibility(
						settings_layout.getVisibility()==View.GONE ? View.VISIBLE : View.GONE );
			}
		});
		return convertView;
	}

	@Override
	public boolean isChildSelectable(int groupPosition, int childPosition) {
		// 指定的 Child 是否是可选择的
		return true;
	}
}
</code></pre>
<h5><span style="color:#ff0000;">NO.5  绑定数据</span></h5>
</div>
<div>
<pre><code class="language-java">ExpandableListView listview=(ExpandableListView)view.findViewById(R.id.playlist_list);

ArrayList&lt;HashMap&lt;String,Object&gt;&gt;allData = new ArrayList&lt;HashMap&lt;String,Object&gt;&gt;();//所有数据
HashMap&lt;String,Object&gt;oneData = new HashMap&lt;String,Object&gt;();
ArrayList&lt;Music&gt;childData	= new ArrayList&lt;Music&gt;();

//模拟数据 start
oneData = new HashMap&lt;String,Object&gt;();
childData	= new ArrayList&lt;Music&gt;();
oneData.put("parentData", "夜的钢琴曲");
for(int j=0;j&lt;4;j++)
{
	Music music=new Music();
	music.music_name="夜的钢琴曲第"+String.valueOf(j)+"首";
	music.singer_name="石进";
	childData.add(music);
}
oneData.put("childData", childData);
allData.add(oneData);
for(int i=1;i&lt;7;i++)
{
	oneData = new HashMap&lt;String,Object&gt;();
	childData	= new ArrayList&lt;Music&gt;();
	oneData.put("parentData", "playlist:"+String.valueOf(i));
	for(int j=0;j&lt;4;j++)
	{
		Music music=new Music();
		music.music_name="music:"+String.valueOf(j);
		music.singer_name="singer:"+String.valueOf(j);
		childData.add(music);
	}
	oneData.put("childData", childData);
	allData.add(oneData);
}
//模拟数据 end

Playlist_ExListAdapter adapter =new Playlist_ExListAdapter(getActivity(),allData);
listview.setAdapter(adapter);

for (int i = 0; i &lt; adapter.getGroupCount(); i++)//关闭所有
	listview.collapseGroup(i);//listview.collapseGroup(i);//展开所有</code></pre>
</div>
<div><span style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.984375px;"><strong></strong></span></div>
<br><p style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.98958396911621px;">
<span style="font-family:'Microsoft YaHei';font-size:12px;"><strong>/**************************************************************************************************</strong></span></p>
<p style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.98958396911621px;">
<span style="font-family:'Microsoft YaHei';font-size:12px;"><strong><span style="color:rgb(255,0,0);"> *  本博客为</span><span style="color:rgb(51,51,255);">CSDN博主【MK】原创</span><span style="color:rgb(255,0,0);">，博客</span><span style="line-height:25.98958396911621px;color:rgb(255,0,0);">地址：<span style="color:#6a3906;"></span><a href="http://blog.csdn.net/mkrcpp/article/details/13170649" rel="nofollow"><span style="color:rgb(106,57,6);">http://blog.csdn.net/mkrcpp/article/details/</span><span style="color:rgb(106,57,6);">13170649</span></a></span></strong></span></p>
<p style="color:rgb(54,46,43);font-family:Arial;font-size:14px;line-height:25.98958396911621px;">
<span style="font-family:'Microsoft YaHei';"><span style="font-size:12px;"> **********************************************************************************************************************/</span></span></p>
            </div>

